{{- /* -*- mode: emacs-lisp -*- */ -}}

;;; post-init.el --- Post Init -*- no-byte-compile: t; lexical-binding: t; -*-

;;;; Packages
;; Native compilation enhances Emacs performance by converting Elisp code into
;; native machine code, resulting in faster execution and improved
;; responsiveness.
;;
;; Ensure adding the following compile-angel code at the very beginning
;; of your `~/.emacs.d/post-init.el` file, before all other packages.
(use-package compile-angel
  :demand t
  :ensure t
  :custom
  ;; Set `compile-angel-verbose` to nil to suppress output from compile-angel.
  ;; Drawback: The minibuffer will not display compile-angel's actions.
  (compile-angel-verbose t)

  :config
  ;; The following directive prevents compile-angel from compiling your init
  ;; files. If you choose to remove this push to `compile-angel-excluded-files'
  ;; and compile your pre/post-init files, ensure you understand the
  ;; implications and thoroughly test your code. For example, if you're using
  ;; the `use-package' macro, you'll need to explicitly add:
  ;; (eval-when-compile (require 'use-package))
  ;; at the top of your init file.
  (push "/init.el" compile-angel-excluded-files)
  (push "/early-init.el" compile-angel-excluded-files)
  (push "/pre-init.el" compile-angel-excluded-files)
  (push "/post-init.el" compile-angel-excluded-files)
  (push "/pre-early-init.el" compile-angel-excluded-files)
  (push "/post-early-init.el" compile-angel-excluded-files)

  ;; A local mode that compiles .el files whenever the user saves them.
  ;; (add-hook 'emacs-lisp-mode-hook #'compile-angel-on-save-local-mode)

  ;; A global mode that compiles .el files prior to loading them via `load' or
  ;; `require'. Additionally, it compiles all packages that were loaded before
  ;; the mode `compile-angel-on-load-mode' was activated.
  (compile-angel-on-load-mode 1))

{{ if contains "fedora" .osid -}}
(use-package auto-dark
  :ensure t
  :config
  (ignore-errors
    (setq auto-dark-themes '((modus-operandi-tinted) (modus-vivendi-tinted)))
    (add-hook 'auto-dark-dark-mode-hook
	      (lambda ()
		(load-theme 'modus-vivendi-tinted :no-confirm)))
    (add-hook 'auto-dark-light-mode-hook
	      (lambda ()
		(load-theme 'modus-operandi-tinted :no-confirm)))
    (auto-dark-mode 1)))

{{ end -}}
(use-package dired
  :ensure nil
  :defer t
  :hook
  (dired-mode . dired-hide-details-mode))

(use-package prog-mode
  :ensure nil
  :config
  (add-hook 'prog-mode-hook 'outline-minor-mode)
  (add-hook 'prog-mode-hook 'hs-minor-mode))

(use-package bicycle
  :ensure t
  :after outline
  :bind (:map outline-minor-mode-map
	      ("TAB" . bicycle-cycle)
	      ("<tab>" . bicycle-cycle)
	      ("S-TAB" . bicycle-cycle-global)
	      ("<backtab>" . bicycle-cycle-global)))

(use-package outline-minor-faces
  :ensure t
  :after outline
  :config (add-hook 'outline-minor-mode-hook
                    #'outline-minor-faces-mode))

(use-package backline
  :ensure t
  :after outline
  :config (advice-add 'outline-flag-region :after 'backline-update))

(use-package god-mode
  :ensure t
  :bind
  ({{- if contains "fedora" .osid -}}
   ("<f9>" . god-local-mode)
   {{ end -}}
   ("C-x C-1" . delete-other-windows)
   ("C-x C-2" . split-window-below)
   ("C-x C-3" . split-window-right)
   ("C-x C-0" . delete-window)
   :map god-local-mode-map
   ("z" . repeat)
   ("[" . backward-paragraph)
   ("]" . forward-paragraph))

  :hook
  (post-command . my-god-mode-update-cursor)
  (post-command . my-god-mode-update-mode-line)

  :init
  (setq god-mode-enable-function-key-translation nil)

  :config
  (defun my-god-mode-update-cursor ()
    (setq cursor-type (if (or god-local-mode buffer-read-only) 'box 'bar))
    (if (or god-local-mode)
        (blink-cursor-mode -1)
      (blink-cursor-mode 1)))

  (defun my-god-mode-update-mode-line ()
    (cond
     (god-local-mode
      (set-face-attribute 'mode-line nil
                          :foreground "#604000"
                          :background "#fff29a")
      (set-face-attribute 'mode-line-inactive nil
                          :foreground "#3f3000"
                          :background "#fff3da"))
     (t
      (set-face-attribute 'mode-line nil
                          :foreground "#0a0a0a"
                          :background "#d7d7d7")
      (set-face-attribute 'mode-line-inactive nil
                          :foreground "#404148"
                          :background "#efefef")))))

;;;;; (use-package devil
;  :init
;  (global-devil-mode)
;
;  :config
;  (setq devil-all-keys-repeatable t))

(use-package org
  :ensure t
  :custom
  (org-log-done 'time)
  (org-log-into-drawer t)

  (org-todo-keywords
   '((sequence "ACTIVITY(a)" "NEXT(n)" "PROJECT(p)" "SOMEDAY(s)" "WAITING(w)" "|" "DONE(d)" "CANCELLED(c)")))

  (org-agenda-files nil)
  (org-agenda-prefix-format '((agenda . " %i %?-12t% s")
                              (timeline . "  % s")
                              (todo . " %i %-12:c")
                              (tags . " %i %-12:c")
                              (search . " %i %-12:c")))

  (org-capture-templates
   '(("b" "Bibliographic")
     ("bw" "Website" entry
      (file "{{- template "find" "**/20240316T110159--*" -}}")
      "%(yas-expand-snippet-to-string (yas-lookup-snippet-by-uuid \"20251104T160623\" 'org-mode))"
      :empty-lines 1
      :after-finalize (lambda ()
                       (with-current-buffer (org-capture-get :buffer)
                         (org-bibtex "{{- template "find" "**/20251104T145004--*" -}}"))))
     ("f" "Fuel log" entry
      (file+headline "{{- template "find" "**/20190317T144500--*" -}}" "2025-26")
      "%(yas-expand-snippet-to-string (yas-lookup-snippet-by-uuid \"20251030T105223\" 'org-mode))"
      :empty-lines 1
      :before-finalize (lambda ()
                        (with-current-buffer (org-capture-get :buffer)
                          (org-update-all-dblocks))))
     ("w" "Work schedule" entry
      (file+headline "{{- template "find" "**/20241008T004852--*" -}}" "Employment")
      "%(yas-expand-snippet-to-string (yas-lookup-snippet-by-uuid \"20251103T081423\" 'org-mode))"
      :empty-lines 1)))

  (org-plantuml-jar-path
   (expand-file-name "{{- if contains "android" .osid -}}{{- "/data/data/com.termux/files/usr/share/java/plantuml.jar" | trim -}}{{- else if contains "fedora" .osid -}}{{- output "bash" "-c" "find /home/linuxbrew/.linuxbrew/ -name 'plantuml.jar'" | trim -}}{{- end -}}"))

  :bind (("C-c a" . org-agenda)
	 ("C-c c" . org-capture)
	 :map org-mode-map
              ("C-'" . nil)
	      ("C-," . nil))

  :config
  (add-to-list 'org-modules 'org-habit t)

  (defun refresh-org-agenda-files ()
    (interactive)
    (setq org-agenda-files
          (directory-files-recursively
           "~/Documents"
           ".*_agenda.*\\.org$"))
    (message "Org agenda files refreshed."))
  (refresh-org-agenda-files)

  (defun my/denote-archive-location (location)
    (if (string-match "^denote:\\([0-9]\\{8\\}T[0-9]\\{6\\}\\)::" location)
	(let* ((denote-id (match-string 1 location))
	       (heading-fmt (substring location (match-end 0)))
	       (archive-file (denote-get-path-by-id denote-id)))
	  (cons
	   (or archive-file
	       (error "No Denote file found with ID: %s" denote-id))
	   (format heading-fmt "")))
      (let ((current-file (buffer-file-name (buffer-base-buffer)))
	    (file-fmt (substring location 0 (string-match "::" location)))
	    (heading-fmt (substring location (match-end 0))))
	(cons
	 (if (org-string-nw-p file-fmt)
	     (expand-file-name
	      (format file-fmt (file-name-nondirectory current-file)))
	   current-file)
	 (format heading-fmt (file-name-nondirectory current-file))))))
  (advice-add 'org-archive--compute-location :override #'my/denote-archive-location)


  (defun org-columns-dblock-write-relative-links (ipos table params)
    (let ((link (plist-get params :link))
	  (width-specs
	   (mapcar (lambda (spec) (nth 2 spec))
		   org-columns-current-fmt-compiled)))
      (when table
	(let ((item-index
	       (let ((p (assoc "ITEM" org-columns-current-fmt-compiled)))
		 (and p (cl-position p
				     org-columns-current-fmt-compiled
				     :test #'equal))))
	      (hlines (plist-get params :hlines))
	      (indent (plist-get params :indent))
	      new-table)
	  (push (pop table) new-table)
	  (push (pop table) new-table)
	  (dolist (row table (setq table (nreverse new-table)))
	    (let ((level (car row)))
	      (when (and (not (eq (car new-table) 'hline))
			 (or (eq hlines t)
			     (and (numberp hlines) (<= level hlines))))
		(push 'hline new-table))
	      (when item-index
		(let* ((raw (nth item-index (cdr row)))
		       (cleaned (org-columns--clean-item raw))
		       (item (if (not link) cleaned
			       (let ((search (org-link-heading-search-string raw))
				     (file-path (buffer-file-name)))
				 (org-link-make-string
				  (if (not file-path) search
				    (format "file:%s::%s"
					    (file-relative-name file-path)
					    search))
				  cleaned)))))
		  (setf (nth item-index (cdr row))
			(if (and indent (> level 1))
			    (concat "\\_" (make-string (* 2 (1- level)) ?\s) item)
			  item))))
	      (push (cdr row) new-table))))
	(when (plist-get params :vlines)
	  (setq table
		(let ((size (length org-columns-current-fmt-compiled)))
		  (append (mapcar (lambda (x) (if (eq 'hline x) x (cons "" x)))
				  table)
			  (list (cons "/" (make-list size "<>")))))))
	(when (seq-find #'identity width-specs)
	  (push (mapcar (lambda (width) (when width (format "<%d>" width))) width-specs) table))
	(goto-char ipos)
	(let ((content-lines (org-split-string (plist-get params :content) "\n"))
	      recalc)
	  (when content-lines
	    (while (string-match-p "\\`[ \t]*#\\+" (car content-lines))
	      (insert (string-trim-left (pop content-lines)) "\n")))
	  (save-excursion
	    (insert
	     (mapconcat (lambda (row)
			  (if (eq row 'hline) "|-|"
			    (format "|%s|" (mapconcat #'identity row "|"))))
			table
			"\n"))
	    (let ((case-fold-search t))
	      (dolist (line content-lines)
		(when (string-match-p "\\`[ \t]*#\\+TBLFM:" line)
		  (insert "\n" (string-trim-left line))
		  (unless recalc (setq recalc t))))))
	  (when recalc (org-table-recalculate 'all t))
	  (org-table-align)
	  (when (seq-find #'identity width-specs)
	    (org-table-shrink))))))
  (setq org-columns-dblock-formatter #'org-columns-dblock-write-relative-links)

  (org-babel-do-load-languages
   'org-babel-load-languages
   '((emacs-lisp . t)
     (plantuml . t)
     (python . t)
     (shell . t))))

(use-package org-web-tools
  :ensure t
  :after org)

(use-package avy
  :ensure t
  :commands (avy-goto-char
             avy-goto-char-2
             avy-next)

  :init
  (global-set-key (kbd "C-'") 'avy-goto-char-2))

(use-package hide-mode-line
  :ensure t
  :config
  (add-hook 'completion-list-mode-hook #'hide-mode-line-mode)
  (add-hook 'nov-mode-hook #'hide-mode-line-mode))

(use-package magit
  :ensure t)

(use-package yasnippet
  :ensure t
  :config
  (yas-global-mode t)
  (setq yas-snippet-dirs
        '("{{- template "find" "*/custom-snippets" -}}"))

  (defun yas-expand-snippet-to-string (template-or-lookup)
    (when template-or-lookup
      (with-temp-buffer
	(yas-minor-mode 1)
	(yas-expand-snippet template-or-lookup)
	(buffer-string))))

  (defun yas-lookup-snippet-by-uuid (uuid &optional mode noerror)
    (let ((template
	   (if mode
	       (when-let ((table (gethash mode yas--tables)))
		 (gethash uuid (yas--table-uuidhash table)))
	     (let ((result nil))
	       (maphash (lambda (_mode table)
			  (when-let ((tmpl (gethash uuid (yas--table-uuidhash table))))
			    (setq result tmpl)))
			yas--tables)
	       result))))
      (or template
	  (unless noerror
	    (error "No snippet with uuid: %s%s" uuid
		   (if mode (format " in mode: %s" mode) ""))))))

  (yas-reload-all))

;; Vertico provides a vertical completion interface, making it easier to
;; navigate and select from completion candidates (e.g., when `M-x` is pressed).
(use-package vertico
  ;; (Note: It is recommended to also enable the savehist package.)
  :ensure t
  :config
  (vertico-mode))

(use-package savehist
  :ensure nil
  :init
  (savehist-mode))

;; Vertico leverages Orderless' flexible matching capabilities, allowing users
;; to input multiple patterns separated by spaces, which Orderless then
;; matches in any order against the candidates.
(use-package orderless
  :ensure t
  :custom
  (completion-styles '(orderless basic))
  (completion-category-defaults nil)
  (completion-category-overrides '((file (styles partial-completion)))))

;; Marginalia allows Embark to offer you preconfigured actions in more contexts.
;; In addition to that, Marginalia also enhances Vertico by adding rich
;; annotations to the completion candidates displayed in Vertico's interface.
(use-package marginalia
  :ensure t
  :commands (marginalia-mode marginalia-cycle)
  :hook (after-init . marginalia-mode))

;; Embark integrates with Consult and Vertico to provide context-sensitive
;; actions and quick access to commands based on the current selection, further
;; improving user efficiency and workflow within Emacs. Together, they create a
;; cohesive and powerful environment for managing completions and interactions.
(use-package embark
  ;; Embark is an Emacs package that acts like a context menu, allowing
  ;; users to perform context-sensitive actions on selected items
  ;; directly from the completion interface.
  :ensure t
  :commands (embark-act
             embark-dwim
             embark-export
             embark-collect
             embark-bindings
             embark-prefix-help-command)
  :bind
  (("C-." . embark-act)         ;; pick some comfortable binding
   ("C-;" . embark-dwim)        ;; good alternative: M-.
   ("C-h B" . embark-bindings)) ;; alternative for `describe-bindings'

  :init
  (setq prefix-help-command #'embark-prefix-help-command)

  :config
  ;; Hide the mode line of the Embark live/completions buffers
  (add-to-list 'display-buffer-alist
               '("\\`\\*Embark Collect \\(Live\\|Completions\\)\\*"
                 nil
                 (window-parameters (mode-line-format . none)))))

(use-package embark-consult
  :ensure t
  :hook
  (embark-collect-mode . consult-preview-at-point-mode))

;; Consult offers a suite of commands for efficient searching, previewing, and
;; interacting with buffers, file contents, and more, improving various tasks.
(use-package consult
  :ensure t
  :bind (;; C-c bindings in `mode-specific-map'
         ("C-c M-x" . consult-mode-command)
         ("C-c h" . consult-history)
         ("C-c k" . consult-kmacro)
         ("C-c m" . consult-man)
         ("C-c i" . consult-info)
         ([remap Info-search] . consult-info)
         ;; C-x bindings in `ctl-x-map'
         ("C-x M-:" . consult-complex-command)
         ("C-x b" . consult-buffer)
         ("C-x 4 b" . consult-buffer-other-window)
         ("C-x 5 b" . consult-buffer-other-frame)
         ("C-x t b" . consult-buffer-other-tab)
         ("C-x r b" . consult-bookmark)
         ("C-x p b" . consult-project-buffer)
         ;; Custom M-# bindings for fast register access
         ("M-#" . consult-register-load)
         ("M-'" . consult-register-store)
         ("C-M-#" . consult-register)
         ;; Other custom bindings
         ("M-y" . consult-yank-pop)
         ;; M-g bindings in `goto-map'
         ("M-g e" . consult-compile-error)
         ("M-g f" . consult-flymake)
         ("M-g g" . consult-goto-line)
         ("M-g M-g" . consult-goto-line)
         ("M-g o" . consult-outline)
         ("M-g m" . consult-mark)
         ("M-g k" . consult-global-mark)
         ("M-g i" . consult-imenu)
         ("M-g I" . consult-imenu-multi)
         ;; M-s bindings in `search-map'
         ("M-s d" . consult-find)
         ("M-s c" . consult-locate)
         ("M-s g" . consult-grep)
         ("M-s G" . consult-git-grep)
         ("M-s r" . consult-ripgrep)
         ("M-s l" . consult-line)
         ("M-s L" . consult-line-multi)
         ("M-s k" . consult-keep-lines)
         ("M-s u" . consult-focus-lines)
         ;; Isearch integration
         ("M-s e" . consult-isearch-history)
         :map isearch-mode-map
         ("M-e" . consult-isearch-history)
         ("M-s e" . consult-isearch-history)
         ("M-s l" . consult-line)
         ("M-s L" . consult-line-multi)
         ;; Minibuffer history
         :map minibuffer-local-map
         ("M-s" . consult-history)
         ("M-r" . consult-history))

  ;; Enable automatic preview at point in the *Completions* buffer.
  :hook (completion-list-mode . consult-preview-at-point-mode)

  :init
  ;; Optionally configure the register formatting. This improves the register
  (setq register-preview-delay 0.5
        register-preview-function #'consult-register-format)

  ;; Optionally tweak the register preview window.
  (advice-add #'register-preview :override #'consult-register-window)

  ;; Use Consult to select xref locations with preview
  (setq xref-show-xrefs-function #'consult-xref
        xref-show-definitions-function #'consult-xref)

  ;; Aggressive asynchronous that yield instantaneous results. (suitable for
  ;; high-performance systems.) Note: Minad, the author of Consult, does not
  ;; recommend aggressive values.
  ;; Read: https://github.com/minad/consult/discussions/951
  ;;
  ;; However, the author of minimal-emacs.d uses these parameters to achieve
  ;; immediate feedback from Consult.
  ;; (setq consult-async-input-debounce 0.02
  ;;       consult-async-input-throttle 0.05
  ;;       consult-async-refresh-delay 0.02)

  :config
  (consult-customize
   consult-theme :preview-key '(:debounce 0.2 any)
   consult-ripgrep consult-git-grep consult-grep
   consult-bookmark consult-recent-file consult-xref
   consult--source-bookmark consult--source-file-register
   consult--source-recent-file consult--source-project-recent-file
   ;; :preview-key "M-."
   :preview-key '(:debounce 0.4 any))
  (setq consult-narrow-key "<"))

(use-package denote
  :ensure t
  :custom
  (denote-directory "~/Documents")

  :hook
  (dired-mode . denote-dired-mode))

(use-package denote-journal
  :ensure t
  :after denote
  :custom
  (denote-journal-directory (expand-file-name "journal" denote-directory))
  (denote-journal-keyword "journal")
  (denote-journal-title-format 'day-date-month-year))

(use-package consult-notes
  :ensure t
  :commands (consult-notes
             consult-notes-search-in-all-notes
             consult-notes-org-roam-find-node
             consult-notes-org-roam-find-node-relation)

  :preface
  (defun consult-notes-filtered ()
    (interactive)
    (let ((denote-excluded-files-regexp "_archive\\(_\\|\\.\\)"))
      (call-interactively #'consult-notes)))

  :bind (("C-c n a" . consult-notes)
         ("C-c n f" . consult-notes-filtered))

  :config
  (when (locate-library "denote")
    (consult-notes-denote-mode)))

;;;;; (use-package dictionary
;  :bind
;  ("M-#" . dictionary-lookup-definition))

(use-package biblio
  :ensure t)

(use-package citar
  :ensure t
  :defer t
  :custom
  (citar-bibliography '("{{- template "find" "**/20251008T085257--*" -}}"
			"{{- template "find" "**/20251107T112447--*" -}}"
			"{{- template "find" "**/20251104T145004--*" -}}"
			"{{- template "find" "**/20251107T113324--*" -}}"))

  :bind
  (("C-c w b o" . citar-open))

  :config
  (setq citar-file-additional-files-separator "__")
  (setq citar-library-paths
        '("~/Audiobooks" "~/Ebooks" {{- if contains "android" .osid }} "~/Audiobooks/.placeholders" "~/Ebooks/.placeholders"{{- end -}}))
  (setq citar-templates
        '((main . "${title:48}     ${author editor:30%sn}     ${date year issued:4}")
          (suffix . "          ${=key= id:15}    ${=type=:12}    ${tags keywords:*}")
          (preview . "${author editor:%etal} (${year issued date}) ${title}, ${journal journaltitle publisher container-title collection-title}.\n")
          (note . "Notes on ${author editor:%etal}, ${title}"))))

(use-package citar-denote
  :ensure t
  :custom
  (citar-open-always-create-notes t)

  :bind
  (("C-c w b c" . citar-create-note)
   ("C-c w b n" . citar-denote-open-note)
   ("C-c w b x" . citar-denote-nocite)
   :map org-mode-map
   ("C-c w b k" . citar-denote-add-citekey)
   ("C-c w b K" . citar-denote-remove-citekey)
   ("C-c w b d" . citar-denote-dwim)
   ("C-c w b e" . citar-denote-open-reference-entry))

  :init
  (citar-denote-mode))

{{ if contains "fedora" .osid -}}
(use-package emms
  :ensure t
  :custom
  (emms-player-list '(emms-player-mpv))
  (emms-player-mpv-update-metadata t)
  (emms-repeat-playlist t)

  :bind-keymap
  (("C-c r" . emms-playlist-mode-map))

  :init
  (emms-standard)

  :config
  (emms-playing-time-disable-display)
  (emms-add-m3u-playlist "{{- template "find" "*/Transistor/**/collection.m3u" -}}"))

{{ end -}}
(use-package titlecase
  :ensure t
  :defer t)

(use-package jinx
  :ensure t
  :hook (emacs-startup . global-jinx-mode)
  :bind (("M-$" . jinx-correct)
         ("C-M-$" . jinx-languages)))

(use-package nov
  :ensure t
  {{ if contains "android" .osid -}}
  :bind (("<volume-up>" . nov-scroll-down)
         ("<volume-down>" . nov-scroll-up))

  {{ end -}}
  :hook ((nov-mode . (lambda ()
                       (display-line-numbers-mode -1)))
         (nov-mode-hook . (lambda ()
                            (make-local-variable 'my-line-numbers-enabled)
                            (setq my-line-numbers-enabled nil))))

  :init
  (add-to-list 'auto-mode-alist '("\\.epub\\'" . nov-mode))

  :config
  (display-line-numbers-mode 0))

(use-package f
  :ensure t)

;;;; Functions
(defun my/extract-pins-from-org ()
  "Extract pins from the specified Org file and display them in a temporary buffer."
  (interactive)
  (let ((org-file-path "{{- template "find" "**/20240808T080919--*" -}}"))  ;; Specify your Org file path here
    (if (file-exists-p org-file-path)
        (progn
          (org-babel-load-file org-file-path)
          (message "Pins extracted successfully."))
      (error "Org file not found: %s" org-file-path))))

(defun org-fetch-xcweather-forecast ()
  "Fetch XCWeather forecast for the postcode found in the Org heading at point."
  (interactive)
  (when (org-at-heading-p)
    (let* ((heading (org-get-heading t t t t))
           (postcode (org-entry-get (point) "POSTCODE")))
      (if postcode
          (progn
            (setq postcode (downcase postcode))  ;; Make postcode lowercase
            (let ((url (concat "https://www.xcweather.co.uk/forecast/" (replace-regexp-in-string " " "_" postcode))))
              (message "Fetching XCWeather forecast for postcode: %s" postcode)
              (browse-url url)))  ;; Open the URL in the browser
        (message "No postcode found in the properties.")))))

(defun keepassxc ()
  (interactive)
  {{ if contains "android" .osid -}}
  (let ((command "am startservice --user 0 -n com.termux/com.termux.app.RunCommandService \
-a com.termux.RUN_COMMAND \
--es com.termux.RUN_COMMAND_PATH '{{- template "find" "**/bin/keepassxc.sh" -}}' \
--esa com.termux.RUN_COMMAND_ARGUMENTS '' \
--es com.termux.RUN_COMMAND_WORKDIR '{{- .chezmoi.homeDir -}}' \
--ez com.termux.RUN_COMMAND_BACKGROUND 'true' \
--es com.termux.RUN_COMMAND_SESSION_ACTION '0'"))
    (shell-command command))

  {{- else if contains "linux" .osid -}}
  (shell-command "{{- template "find" "**/bin/keepassxc.sh" -}}")
  {{- end -}})
